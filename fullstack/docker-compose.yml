version: '3.8'

services:

 frontend:
  container_name: frontend
  image: nginx:latest
  ports:
    - "81:80"
  volumes:
    - ./frontend:/usr/share/nginx/html:ro


 backend:
  container_name: backend
  image: backend-backend
  build:
   context: .
   dockerfile: Dockerfile
  ports:
   - "82:9000"
  depends_on:
   - db
  environment:
      - ConnectionStrings__DefaultConnection=Server=db;Port=3306;Database=db;User=user;Password=password;
      - ALLOWED_CORS_ORIGINS=http://192.168.1.100,http://organisation_network.local
  networks:
      - intranet


 db:
  container_name: db
  image: mysql:8.0
  restart: always
  environment:
   MYSQL_DATABASE: 'db'
   MYSQL_USER: 'user'
   MYSQL_PASSWORD: 'password'
   MYSQL_ROOT_PASSWORD: 'password'
  ports:
   - '83:3306'
  expose:
   - '3906'
  volumes:
   - my-db:/var/lib/mysql
  networks:
      - intranet

volumes:
  my-db:
  
networks:
  intranet:
   driver: bridge